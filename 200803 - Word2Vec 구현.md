# Chapter3 word2vec


## Matmul 클래스

```python
class Matmul:
  def __init__(self,W):
    self.params=[W]
    self.grads=[np.zeros_like(W)]
    self.x=None
    
  def forward(self,x):
    W,=self.params
    out=np.matmul(x,W)
    self.x=x
    return out
    
  def backward(self,dout):
    W,=self.params
    dx=np.matmul(dout,W.T)
    dW=np.matmul(self.x.T,dout)
    self.grads[0][...]=dW
    return dx 
```

## 전처리 함수 
```python
def preprocess(text):
  text=text.lower()
  text=text.replace('.',' .')
  words=text.split(' ')
  word_to_id={}
  a=0
  for i in words:
    if i not in word_to_id:
      word_to_id[i]=a
      a+=1
  id_to_word={}
  a=0
  for i in words:
    if i not in list(id_to_word.values()):
    id_to_word[a]=i
    a+=1
  corpus=[]
    for i in words:
      corpus.append(word_to_id[i])
  return corpus, word_to_id, id_to_word 
```

## 전처리 후 one_hot_vector 변환, contexts, target 변환
```python
def create_contexts_target(corpus,window_size):
  contexts=[]
  target=[]
  for i in range(len(corpus)):
    a=[0]*(len(corpus)-1)
    a[corpus[i]]=1
    corpus=list(corpus)
    corpus[i]=a
  for i in range(1,len(corpus)-window_size):
    contexts.append([corpus[i-window_size],corpus[i+window_size]])
    target.append(corpus[i])
  return np.array(contexts),np.array(target)  
```

## CBOW 클래스 구현

- CBOW --> 맥락으로부터 타깃을 추론
- 단어 벡터 --> 입력층의 가중치(W_in) 로 표현
- 활성함수 --> 다중 클래스 분류: 소프트맥스 함수
- 손실 함수 --> 교차 엔트로피 오차

```python
 class simpleCBOW:
    def __init__(self,vocab_size,hidden_size):
      v,h=vocab_size,hidden_size
      w_in=0.01*np.random.randn(v,h).astype('f')
      w_out=0.01*np.random.randn(h,v).astype('f')
      self.in_layer0=Matmul(w_in)
      self.in_layer1=Matmul(w_in)
      self.out_layer=Matmul(w_out)
      self.loss_layer=SoftmaxWithLoss()
      layers=[self.in_layer0, self.in_layer1, self.out_layer]
      self.params, self.grads=[], []
      
      for layer in layers:
        self.params+=layer.params
        self.grads+=layer.grads
         self.word_vecs=w_in
         
     def forward(self,contexts,target):
        h0=self.in_layer0.forward(contexts[:,0])
        h1=self.in_layer1.forward(contexts[:,1])
        h=0.5*(h0+h1)
        score=self.out_layer.forward(h)
        loss=self.loss_layer.forward(score,target)
        return loss
        
     def backward(self,dout=1):
        ds=self.loss_layer.backward(dout)
        da=self.out_layer.backward(ds)
        da*=0.5
        self.in_layer0.backward(da)
        self.in_layer1.backward(da)
        return None
```

## simple CBOW 학습 구현


  
